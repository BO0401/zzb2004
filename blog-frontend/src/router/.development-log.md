# Router 路由系统开发日志

## 路由结构
- 首页路由 (`/`)
- 教程列表 (`/tutorials`)
- 教程详情 (`/tutorial/:id`)
- 项目展示 (`/projects`)
- 关于我 (`/about`)
- 联系我 (`/contact`)
- 404页面 (`/:pathMatch(.*)*`)

## 问题记录与解决方案

### 问题1：动态导入模块失败
**错误信息**：
```
TypeError: Failed to fetch dynamically imported module: http://localhost:3000/src/views/Home.vue
```
**原因**：组件文件路径错误或文件不存在
**解决方案**：
1. 确认所有视图组件文件存在
2. 检查import路径的正确性
3. 添加错误边界处理
```typescript
component: () => import('../views/Home.vue').catch(() => {
  return import('../views/404.vue')
})
```
**改进**：为所有动态导入添加错误处理

### 问题2：Vue Router 4语法变更
**问题**：404路由通配符语法不兼容
**解决方案**：
```typescript
// 旧语法
{ path: '*', component: NotFound }

// 新语法
{ path: '/:pathMatch(.*)*', name: 'NotFound', component: NotFound }
```
**改进**：使用Vue Router 4的新语法

### 问题3：路由参数传递
**问题**：动态路由参数无法正确传递给组件
**解决方案**：
```typescript
{
  path: '/tutorial/:id',
  name: 'TutorialDetail',
  component: () => import('../views/TutorialDetail.vue'),
  props: true // 将路由参数作为props传递
}
```
**改进**：使用props模式传递路由参数

### 问题4：页面加载进度指示
**问题**：页面切换时缺少加载反馈
**解决方案**：
```typescript
import NProgress from 'nprogress'

router.beforeEach((to, from, next) => {
  NProgress.start()
  next()
})

router.afterEach(() => {
  NProgress.done()
})
```
**改进**：添加nprogress进度条显示

### 问题5：页面标题动态设置
**问题**：所有页面标题相同，不利于SEO
**解决方案**：
```typescript
router.beforeEach((to, from, next) => {
  if (to.meta?.title) {
    document.title = `${to.meta.title} - 我的博客`
  }
  next()
})
```
**改进**：在路由meta中定义页面标题

## 路由结构的演进过程

### 第一版：基础结构
**初始想法**: "先把基本的页面路由搭建起来，保证用户能正常访问各个页面。"

```typescript
const routes = [
  { path: '/', component: Home },
  { path: '/about', component: About },
  // 简单直接，但缺乏层次感
]
```

### 第二版：增加层次结构
**思考过程**: "博客内容应该有分类，教程和项目需要详情页，这需要嵌套路由。"

```typescript
const routes = [
  {
    path: '/tutorials',
    children: [
      { path: '', component: Tutorials },
      { path: ':category', component: TutorialCategory },
      { path: 'detail/:id', component: TutorialDetail }
    ]
  }
]
```

### 最终版：完整的路由系统
**设计理念**: "每个路由都应该有明确的目的，每个参数都应该有实际意义。"

## 具体路由的设计思路

### 首页路由 ('/')
```typescript
{
  path: '/',
  name: 'Home',
  component: () => import('@/views/Home.vue'),
  meta: {
    title: '首页',
    keepAlive: true  // 首页内容相对稳定，可以缓存
  }
}
```

**设计考虑**: "首页是用户的第一印象，必须快速加载。使用 keepAlive 可以避免重复渲染。"

### 教程相关路由
```typescript
// 教程列表
{
  path: '/tutorials',
  name: 'Tutorials',
  component: () => import('@/views/Tutorials.vue')
},
// 教程分类
{
  path: '/tutorials/category/:category',
  name: 'TutorialCategory',
  component: () => import('@/views/TutorialCategory.vue'),
  props: true  // 将路由参数作为 props 传递，更优雅
},
// 教程详情
{
  path: '/tutorials/:id',
  name: 'TutorialDetail',
  component: () => import('@/views/TutorialDetail.vue'),
  props: true
}
```

**心理分析**: "教程是博客的核心内容，路由结构要能支持分类浏览和直接访问。用户可能会收藏某个教程的链接，所以 URL 要稳定且有意义。"

### 项目展示路由
```typescript
{
  path: '/projects',
  name: 'Projects',
  component: () => import('@/views/Projects.vue')
},
{
  path: '/projects/:id',
  name: 'ProjectDetail',
  component: () => import('@/views/ProjectDetail.vue'),
  props: true
}
```

**设计思考**: "项目展示页面可能包含大量图片和演示，需要考虑加载性能。详情页的路由参数设计要能支持项目的唯一标识。"

## 遇到的技术挑战

### 挑战1：动态导入的错误处理
**问题现象**:
```
TypeError: Failed to fetch dynamically imported module
```

**问题分析**: "这个错误通常出现在开发环境中，可能是因为文件路径问题或者 Vite 的热更新机制。"

**解决过程**:
1. 检查文件路径是否正确
2. 确认组件文件是否存在
3. 重启开发服务器
4. 清理缓存重新构建

**最终解决方案**:
```typescript
// 添加错误边界处理
const Home = () => import('@/views/Home.vue').catch(err => {
  console.error('Failed to load Home component:', err)
  // 可以返回一个错误组件
  return import('@/views/404.vue')
})
```

### 挑战2：路由守卫的设计
**需求分析**: "虽然是静态博客，但也需要一些基础的路由守卫，比如页面标题的设置、进度条的显示等。"

**实现思路**:
```typescript
// 全局前置守卫
router.beforeEach((to, from, next) => {
  // 显示加载进度条
  NProgress.start()
  
  // 设置页面标题
  if (to.meta?.title) {
    document.title = `${to.meta.title} - 个人博客`
  }
  
  next()
})

// 全局后置钩子
router.afterEach(() => {
  // 隐藏加载进度条
  NProgress.done()
})
```

**心理过程**: "用户在页面切换时应该有明确的反馈，进度条虽然是个小细节，但能显著提升用户体验。"

### 挑战3：404 页面的处理
**设计考虑**: "用户可能会访问不存在的页面，需要一个友好的 404 页面来引导用户。"

```typescript
{
  path: '/:pathMatch(.*)*',
  name: 'NotFound',
  component: () => import('@/views/404.vue'),
  meta: {
    title: '页面未找到'
  }
}
```

**创意思考**: "404 页面不应该是一个死胡同，而应该是一个新的起点，引导用户回到有用的内容。"

## 性能优化的思考

### 代码分割策略
```typescript
// 按功能模块分割
const Tutorials = () => import(
  /* webpackChunkName: "tutorials" */ 
  '@/views/Tutorials.vue'
)

const Projects = () => import(
  /* webpackChunkName: "projects" */ 
  '@/views/Projects.vue'
)
```

**优化理念**: "用户不需要一次性加载所有页面的代码，按需加载能显著提升首屏性能。"

### 路由预加载
```typescript
// 在用户可能访问的页面上预加载
router.beforeEach((to, from, next) => {
  // 如果用户在首页，预加载教程页面
  if (to.name === 'Home') {
    import('@/views/Tutorials.vue')
  }
  next()
})
```

### 问题5：路由元信息管理
**问题**：页面标题和SEO信息管理混乱
**解决方案**：
```typescript
{
  path: '/tutorial/:id',
  name: 'TutorialDetail',
  component: () => import('../views/TutorialDetail.vue'),
  meta: {
    title: '教程详情',
    requiresAuth: false
  }
}
```
**改进**：统一管理路由元信息，支持动态标题